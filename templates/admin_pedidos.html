<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pedidos - Croche by Ju</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #e6d5f0 0%, #d0e8f2 50%, #f5e8d0 100%);
            color: #5a4a6a;
            min-height: 100vh;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        nav {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .logo {
            font-size: 2em;
            color: #b19cd9;
            font-weight: bold;
            text-decoration: none;
        }

        .logo::before {
            content: "üß∂ ";
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 30px;
        }

        nav a {
            text-decoration: none;
            color: #5a4a6a;
            font-weight: 500;
            transition: color 0.3s;
        }

        nav a:hover {
            color: #b19cd9;
        }

        .container {
            max-width: 1400px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .admin-header {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .admin-header h1 {
            color: #b19cd9;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .admin-header p {
            color: #7a6a8a;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .stat-icon {
            font-size: 3em;
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
        }

        .stat-icon.pendente {
            background: #fff3cd;
        }

        .stat-icon.confirmado {
            background: #d4edda;
        }

        .stat-icon.total {
            background: #d0e8f2;
        }

        .stat-info h3 {
            color: #7a6a8a;
            font-size: 0.95em;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .stat-info .numero {
            font-size: 2em;
            color: #5a4a6a;
            font-weight: bold;
        }

        .pedidos-table {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .filtros {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .filtro-btn {
            padding: 10px 20px;
            background: #f0e8f5;
            border: 2px solid #b19cd9;
            border-radius: 25px;
            color: #5a4a6a;
            font-family: 'Georgia', serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filtro-btn:hover, .filtro-btn.active {
            background: #b19cd9;
            color: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: linear-gradient(135deg, #f8f4fb, #f4f9fc);
        }

        th {
            padding: 15px;
            text-align: left;
            color: #5a4a6a;
            font-weight: 600;
            border-bottom: 2px solid #e6d5f0;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #f0e8f5;
        }

        tbody tr:hover {
            background: #faf8fc;
        }

        .badge {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            display: inline-block;
        }

        .badge-pendente {
            background: #fff3cd;
            color: #856404;
        }

        .badge-confirmado {
            background: #d4edda;
            color: #155724;
        }

        .badge-producao {
            background: #d0e8f2;
            color: #004085;
        }

        .badge-concluido {
            background: #b8daff;
            color: #004085;
        }

        .badge-enviado {
            background: #c3e6cb;
            color: #155724;
        }

        .badge-entregue {
            background: #d4edda;
            color: #155724;
            font-weight: bold;
        }

        .badge-cancelado {
            background: #f8d7da;
            color: #721c24;
        }

        .pedido-id {
            font-family: monospace;
            color: #b19cd9;
            font-weight: bold;
        }

        .cliente-info {
            line-height: 1.5;
        }

        .cliente-nome {
            font-weight: 600;
            color: #5a4a6a;
        }

        .cliente-contato {
            font-size: 0.9em;
            color: #7a6a8a;
        }

        .acoes {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn-acao {
            padding: 6px 12px;
            border: none;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Georgia', serif;
        }

        .btn-ver {
            background: #9bc4d9;
            color: white;
        }

        .btn-confirmar {
            background: #4CAF50;
            color: white;
        }

        .btn-cancelar {
            background: #f4a6b0;
            color: white;
        }

        .btn-acao:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-state h2 {
            color: #b19cd9;
            margin-bottom: 15px;
        }

        .empty-state p {
            color: #7a6a8a;
            font-size: 1.1em;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-header h2 {
            color: #b19cd9;
        }

        .btn-close {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #7a6a8a;
        }

        .info-group {
            margin-bottom: 20px;
        }

        .info-group label {
            display: block;
            color: #7a6a8a;
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .info-group .value {
            color: #5a4a6a;
            font-size: 1.05em;
        }

        .status-timeline {
            margin: 30px 0;
            padding: 20px;
            background: #f8f4fb;
            border-radius: 15px;
        }

        .status-timeline h3 {
            color: #5a4a6a;
            margin-bottom: 20px;
            text-align: center;
        }

        .timeline-item {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .timeline-item.active {
            background: #b19cd9;
            color: white;
        }

        .timeline-item.completed {
            background: #d4edda;
            color: #155724;
        }

        .timeline-icon {
            font-size: 1.5em;
            min-width: 30px;
        }

        .timeline-text {
            font-weight: 600;
        }

        .acoes-modal {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn-acao-modal {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Georgia', serif;
        }

        footer {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px 20px;
            margin-top: 80px;
            text-align: center;
            color: #5a4a6a;
        }

        @media (max-width: 768px) {
            table {
                font-size: 0.85em;
            }

            .acoes {
                flex-direction: column;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <a href="/" class="logo">Croche by Ju</a>
            <ul>
                <li><a href="/">In√≠cio</a></li>
                <li><a href="/produtos">Produtos</a></li>
                <li><a href="/admin/produtos">Admin</a></li>
                <li><a href="/admin/pedidos">Pedidos</a></li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <div class="admin-header">
            <h1>üì¶ Gerenciar Pedidos</h1>
            <p>Visualize e gerencie todos os pedidos da loja</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon pendente">‚è≥</div>
                <div class="stat-info">
                    <h3>Pedidos Pendentes</h3>
                    <div class="numero">{{ pedidos|selectattr('status', 'equalto', 'Pendente')|list|length }}</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon confirmado">‚úì</div>
                <div class="stat-info">
                    <h3>Em Produ√ß√£o</h3>
                    <div class="numero">{{ (pedidos|selectattr('status', 'equalto', 'Confirmado')|list|length) + (pedidos|selectattr('status', 'equalto', 'Producao')|list|length) }}</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon total">üìä</div>
                <div class="stat-info">
                    <h3>Total de Pedidos</h3>
                    <div class="numero">{{ pedidos|length }}</div>
                </div>
            </div>
        </div>

        <div class="pedidos-table">
            <div class="filtros">
                <button class="filtro-btn active" onclick="filtrarPedidos('todos')">Todos</button>
                <button class="filtro-btn" onclick="filtrarPedidos('Pendente')">Pendentes</button>
                <button class="filtro-btn" onclick="filtrarPedidos('Confirmado')">Confirmados</button>
                <button class="filtro-btn" onclick="filtrarPedidos('Producao')">Em Produ√ß√£o</button>
                <button class="filtro-btn" onclick="filtrarPedidos('Concluido')">Conclu√≠dos</button>
                <button class="filtro-btn" onclick="filtrarPedidos('Enviado')">Enviados</button>
                <button class="filtro-btn" onclick="filtrarPedidos('Entregue')">Entregues</button>
                <button class="filtro-btn" onclick="filtrarPedidos('Cancelado')">Cancelados</button>
            </div>

            {% if pedidos %}
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Data</th>
                        <th>Cliente</th>
                        <th>Produto</th>
                        <th>Quantidade</th>
                        <th>Total</th>
                        <th>Pagamento</th>
                        <th>Status</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="pedidos-tbody">
                    {% for pedido in pedidos %}
                    <tr data-status="{{ pedido.status }}">
                        <td>
                            <span class="pedido-id">#{{ "%04d"|format(pedido.id) }}</span>
                        </td>
                        <td>{{ pedido.data_pedido.strftime('%d/%m/%Y') }}</td>
                        <td>
                            <div class="cliente-info">
                                <div class="cliente-nome">{{ pedido.nome_cliente }}</div>
                                <div class="cliente-contato">{{ pedido.email }}</div>
                                <div class="cliente-contato">{{ pedido.telefone }}</div>
                            </div>
                        </td>
                        <td>{{ pedido.produto.nome if pedido.produto else 'N/A' }}</td>
                        <td>{{ pedido.quantidade }}</td>
                        <td><strong style="color: #b19cd9;">R$ {{ "%.2f"|format(pedido.total) }}</strong></td>
                        <td>
                            {% if pedido.status_pagamento == 'Aprovado' %}
                                <span class="badge badge-success">‚úì Pago</span>
                            {% elif pedido.status_pagamento == 'Rejeitado' %}
                                <span class="badge badge-danger">‚úó Rejeitado</span>
                            {% else %}
                                <span class="badge badge-warning">‚è≥ Pendente</span>
                            {% endif %}
                        </td>
                        <td>
                            <span class="badge badge-{{ pedido.status.lower() }}">{{ pedido.status }}</span>
                        </td>
                        <td>
                            <div class="acoes">
                                <button class="btn-acao btn-ver" onclick="verDetalhes({{ pedido.id }})">üëÅÔ∏è Ver</button>
                                {% if pedido.status == 'Pendente' %}
                                    <button class="btn-acao btn-confirmar" onclick="alterarStatus({{ pedido.id }}, 'Confirmado')">‚úì Confirmar</button>
                                {% elif pedido.status == 'Confirmado' %}
                                    <button class="btn-acao btn-confirmar" onclick="alterarStatus({{ pedido.id }}, 'Producao')">üî® Produ√ß√£o</button>
                                {% elif pedido.status == 'Producao' %}
                                    <button class="btn-acao btn-confirmar" onclick="alterarStatus({{ pedido.id }}, 'Concluido')">‚úÖ Concluir</button>
                                {% elif pedido.status == 'Concluido' %}
                                    <button class="btn-acao btn-confirmar" onclick="alterarStatus({{ pedido.id }}, 'Enviado')">üì¶ Enviar</button>
                                {% elif pedido.status == 'Enviado' %}
                                    <button class="btn-acao btn-confirmar" onclick="alterarStatus({{ pedido.id }}, 'Entregue')">üéâ Entregue</button>
                                {% endif %}
                                {% if pedido.status not in ['Cancelado', 'Entregue'] %}
                                    <button class="btn-acao btn-cancelar" onclick="alterarStatus({{ pedido.id }}, 'Cancelado')">‚ùå Cancelar</button>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="empty-state">
                <h2>üì¶ Nenhum pedido ainda</h2>
                <p>Os pedidos realizados pelos clientes aparecer√£o aqui.</p>
            </div>
            {% endif %}
        </div>
    </main>

    <!-- Modal de Detalhes -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Detalhes do Pedido</h2>
                <button class="btn-close" onclick="fecharModal()">‚úï</button>
            </div>
            <div id="modal-body">
                <!-- Conte√∫do ser√° inserido via JavaScript -->
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2026 Croche by Ju - Todos os direitos reservados</p>
        <p>Feito com ‚ù§Ô∏è e muitos pontos de croch√™</p>
    </footer>

    <script>
        // Converter pedidos para JSON manualmente
        const pedidosData = [
            {% for pedido in pedidos %}
            {
                id: {{ pedido.id }},
                nome_cliente: "{{ pedido.nome_cliente }}",
                email: "{{ pedido.email }}",
                telefone: "{{ pedido.telefone }}",
                endereco: "{{ pedido.endereco|replace('\n', ' ')|replace('"', '\\"') }}",
                quantidade: {{ pedido.quantidade }},
                total: {{ pedido.total }},
                status: "{{ pedido.status }}",
                data_pedido: "{{ pedido.data_pedido.strftime('%Y-%m-%d') }}",
                produto: {
                    nome: "{{ pedido.produto.nome if pedido.produto else 'N/A' }}"
                }
            }{% if not loop.last %},{% endif %}
            {% endfor %}
        ];

        function filtrarPedidos(status) {
            const rows = document.querySelectorAll('#pedidos-tbody tr');
            const buttons = document.querySelectorAll('.filtro-btn');
            
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            rows.forEach(row => {
                if (status === 'todos' || row.dataset.status === status) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function verDetalhes(pedidoId) {
            const pedido = pedidosData.find(p => p.id === pedidoId);
            if (!pedido) return;

            const modal = document.getElementById('modal');
            const modalBody = document.getElementById('modal-body');
            
            // Definir timeline de status
            const statusFlow = ['Pendente', 'Confirmado', 'Producao', 'Concluido', 'Enviado', 'Entregue'];
            const statusNames = {
                'Pendente': '‚è≥ Pendente',
                'Confirmado': '‚úì Confirmado',
                'Producao': 'üî® Em Produ√ß√£o',
                'Concluido': '‚úÖ Conclu√≠do',
                'Enviado': 'üì¶ Enviado',
                'Entregue': 'üéâ Entregue',
                'Cancelado': '‚ùå Cancelado'
            };
            
            let timelineHTML = '';
            if (pedido.status === 'Cancelado') {
                timelineHTML = `<div class="timeline-item active">
                    <span class="timeline-icon">‚ùå</span>
                    <span class="timeline-text">Pedido Cancelado</span>
                </div>`;
            } else {
                const currentIndex = statusFlow.indexOf(pedido.status);
                statusFlow.forEach((status, index) => {
                    let itemClass = '';
                    if (index < currentIndex) itemClass = 'completed';
                    else if (index === currentIndex) itemClass = 'active';
                    
                    timelineHTML += `<div class="timeline-item ${itemClass}">
                        <span class="timeline-icon">${statusNames[status].split(' ')[0]}</span>
                        <span class="timeline-text">${statusNames[status].substring(2)}</span>
                    </div>`;
                });
            }
            
            // Bot√µes de a√ß√£o baseado no status
            let acoesHTML = '';
            if (pedido.status === 'Pendente') {
                acoesHTML = `<button class="btn-acao btn-confirmar" onclick="alterarStatusModal(${pedido.id}, 'Confirmado')">‚úì Confirmar Pedido</button>`;
            } else if (pedido.status === 'Confirmado') {
                acoesHTML = `<button class="btn-acao btn-confirmar" onclick="alterarStatusModal(${pedido.id}, 'Producao')">üî® Iniciar Produ√ß√£o</button>`;
            } else if (pedido.status === 'Producao') {
                acoesHTML = `<button class="btn-acao btn-confirmar" onclick="alterarStatusModal(${pedido.id}, 'Concluido')">‚úÖ Marcar como Conclu√≠do</button>`;
            } else if (pedido.status === 'Concluido') {
                acoesHTML = `<button class="btn-acao btn-confirmar" onclick="alterarStatusModal(${pedido.id}, 'Enviado')">üì¶ Marcar como Enviado</button>`;
            } else if (pedido.status === 'Enviado') {
                acoesHTML = `<button class="btn-acao btn-confirmar" onclick="alterarStatusModal(${pedido.id}, 'Entregue')">üéâ Marcar como Entregue</button>`;
            }
            
            if (pedido.status !== 'Cancelado' && pedido.status !== 'Entregue') {
                acoesHTML += `<button class="btn-acao btn-cancelar" onclick="alterarStatusModal(${pedido.id}, 'Cancelado')">‚ùå Cancelar Pedido</button>`;
            }
            
            modalBody.innerHTML = `
                <div class="info-group">
                    <label>Pedido ID:</label>
                    <div class="value pedido-id">#${String(pedido.id).padStart(4, '0')}</div>
                </div>
                <div class="info-group">
                    <label>Data:</label>
                    <div class="value">${pedido.data_pedido}</div>
                </div>
                
                <div class="status-timeline">
                    <h3>Status do Pedido</h3>
                    ${timelineHTML}
                </div>
                
                <div class="info-group">
                    <label>Cliente:</label>
                    <div class="value">${pedido.nome_cliente}</div>
                </div>
                <div class="info-group">
                    <label>E-mail:</label>
                    <div class="value">${pedido.email}</div>
                </div>
                <div class="info-group">
                    <label>Telefone:</label>
                    <div class="value">${pedido.telefone}</div>
                </div>
                <div class="info-group">
                    <label>Endere√ßo:</label>
                    <div class="value">${pedido.endereco}</div>
                </div>
                <div class="info-group">
                    <label>Produto:</label>
                    <div class="value">${pedido.produto.nome}</div>
                </div>
                <div class="info-group">
                    <label>Quantidade:</label>
                    <div class="value">${pedido.quantidade} unidade(s)</div>
                </div>
                <div class="info-group">
                    <label>Total:</label>
                    <div class="value" style="font-size: 1.5em; color: #b19cd9; font-weight: bold;">R$ ${pedido.total.toFixed(2).replace('.', ',')}</div>
                </div>
                
                <div class="acoes-modal">
                    ${acoesHTML}
                </div>
            `;
            
            modal.classList.add('active');
        }

        function alterarStatusModal(pedidoId, novoStatus) {
            fecharModal();
            alterarStatus(pedidoId, novoStatus);
        }

        function fecharModal() {
            document.getElementById('modal').classList.remove('active');
        }

        function alterarStatus(pedidoId, novoStatus) {
            if (confirm(`Deseja alterar o status deste pedido para "${novoStatus}"?`)) {
                window.location.href = `/admin/pedido/${pedidoId}/status/${novoStatus}`;
            }
        }

        // Fechar modal clicando fora
        document.getElementById('modal').addEventListener('click', function(e) {
            if (e.target === this) {
                fecharModal();
            }
        });
    </script>
</body>
</html>